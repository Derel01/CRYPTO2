# Архитектура приложения

## Общий обзор

Приложение построено на архитектуре клиент-сервер и состоит из следующих компонентов:

1. **Бэкенд (серверная часть)**: API-сервер, обрабатывающий запросы и работающий с базой данных
2. **Фронтенд (клиентская часть)**: Веб-интерфейс для взаимодействия с приложением
3. **База данных**: Хранение данных о командах и хэшах

## Схема архитектуры

```
+------------------+       HTTP        +------------------+        +------------------+
|                  |    Requests      |                  |        |                  |
|    Frontend      |<---------------->|     Backend      |<------>|    Database      |
|    (React)       |                  |    (FastAPI)     |        | (MongoDB/SQL)    |
|                  |                  |                  |        |                  |
+------------------+                  +------------------+        +------------------+
```

## Компоненты

### Бэкенд (FastAPI)

Бэкенд построен с использованием FastAPI - современного Python-фреймворка для создания API. Основные компоненты:

- **server.py/server_sql.py**: Основной файл приложения, содержащий все API-маршруты
- **Models**: Pydantic-модели для валидации данных и SQLAlchemy-модели для работы с базой данных
- **API Endpoints**: REST API для работы с командами и хэшами
- **Business Logic**: Логика расчетов количества лотов, остатков и других показателей

### Фронтенд (React)

Фронтенд построен с использованием React - JavaScript-библиотеки для создания пользовательских интерфейсов. Основные компоненты:

- **App.js**: Основной компонент приложения, содержащий маршрутизацию
- **Components**: 
  - Teams.js: Компонент для отображения списка команд
  - TeamDetail.js: Компонент для отображения детальной информации о команде
  - TeamForm.js: Форма для создания/редактирования команды
  - HashForm.js: Форма для создания/редактирования хэша
  - Calculations.js: Компонент для отображения расчетов по всем командам

### База данных

Приложение поддерживает две версии базы данных:

1. **MongoDB** (исходная версия):
   - Документоориентированная NoSQL база данных
   - Коллекции: teams, crypto_hashes

2. **SQL** (PostgreSQL/SQLite):
   - Реляционная база данных
   - Таблицы: teams, crypto_hashes
   - Связи: One-to-Many между командами и хэшами

## Потоки данных

1. **Создание команды**:
   - Пользователь заполняет форму на фронтенде
   - Фронтенд отправляет POST-запрос к API
   - Бэкенд валидирует данные и сохраняет в базе данных
   - Фронтенд обновляет интерфейс с новыми данными

2. **Добавление хэша**:
   - Пользователь выбирает команду и заполняет форму хэша
   - Фронтенд отправляет POST-запрос к API
   - Бэкенд валидирует данные и сохраняет в базе данных
   - Бэкенд пересчитывает количество лотов и другие показатели
   - Фронтенд обновляет интерфейс с новыми данными

3. **Просмотр расчетов**:
   - Пользователь переходит на страницу расчетов
   - Фронтенд отправляет GET-запрос к API
   - Бэкенд собирает данные о всех командах и хэшах
   - Бэкенд выполняет расчеты (лоты, остатки и т.д.)
   - Фронтенд отображает результаты расчетов

## Модели данных

### Team (Команда)

```
- id: String (UUID)
- name: String
- rub_price_per_lot: Float
- usdt_price_per_lot: Float
- created_at: DateTime
- updated_at: DateTime
```

### CryptoHash (Хэш)

```
- id: String (UUID)
- team_id: String (Foreign Key)
- hash_value: String
- token_amount: Float
- currency: Enum("RUB", "USDT")
- exchange_rate: Float (nullable)
- created_at: DateTime
- updated_at: DateTime
```

### TeamSummary (Расчеты)

```
- team_id: String
- team_name: String
- rub_tokens: Float
- usdt_tokens: Float
- rub_lots_raw: Float
- usdt_lots_raw: Float
- rub_lots: Integer
- usdt_lots: Integer
- total_lots: Integer
- rub_remainder: Float
- usdt_remainder: Float
- rub_needed_for_next_lot: Float
- usdt_needed_for_next_lot: Float
```

## API эндпоинты

### Teams

- `GET /api/teams` - Получить список всех команд
- `GET /api/teams/{team_id}` - Получить информацию о конкретной команде
- `POST /api/teams` - Создать новую команду
- `PUT /api/teams/{team_id}` - Обновить информацию о команде
- `DELETE /api/teams/{team_id}` - Удалить команду

### Hashes

- `GET /api/hashes` - Получить список всех хэшей
- `GET /api/hashes?team_id={team_id}` - Получить хэши для конкретной команды
- `GET /api/hashes/{hash_id}` - Получить информацию о конкретном хэше
- `POST /api/hashes` - Создать новый хэш
- `PUT /api/hashes/{hash_id}` - Обновить информацию о хэше
- `DELETE /api/hashes/{hash_id}` - Удалить хэш

### Calculations

- `GET /api/teams/summary` - Получить расчеты по всем командам
- `GET /api/teams/{team_id}/summary` - Получить расчеты для конкретной команды
